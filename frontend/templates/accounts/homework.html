<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</title>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ Django -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/homework.css' %}">
    
    <!-- CSRF —Ç–æ–∫–µ–Ω –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–æ–≤ -->
    <meta name="csrf-token" content="{{ csrf_token }}">
    
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .grade-display-mode {
            display: block;
        }
        
        .edit-grade-mode {
            display: none;
        }
        
        .grade-display-mode.hidden {
            display: none;
        }
        
        .edit-grade-mode.active {
            display: block;
        }
        
        .cancel-edit-btn {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .cancel-edit-btn:hover {
            background-color: #5a6268;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="profile-section">
                <div class="profile-pic-container">
                    <img src="{% static 'images/default-avatar.png' %}" alt="–§–æ—Ç–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è" class="profile-pic" id="profilePic">
                </div>
                <div class="profile-name" id="profileName">
                    {{ request.user.get_full_name|default:request.user.username }}
                </div>
            </div>
            
            <div class="nav-buttons">
                <a href="{% url 'teacher_dashboard' %}#homeworks" class="nav-btn">‚Üê –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞–Ω–∏—è–º</a>
                <a href="{% url 'teacher_dashboard' %}" class="nav-btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
                <a href="{% url 'logout' %}" class="nav-btn" style="background: #dc3545; color: white;">–í—ã–π—Ç–∏</a>
            </div>
        </nav>
    </header>

    <main>
        <div class="homework-detail-container">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="homework-header">
                <div class="homework-title-section">
                    <h1 class="homework-title">–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ #<span id="homeworkId">{{ homework.id }}</span></h1>
                    <div class="homework-meta">
                        <span class="status-badge status-{{ homework.status }}" id="statusBadge">
                            {{ homework.get_status_display }}
                        </span>
                        <span class="priority-badge priority-{{ homework.priority }}" id="priorityBadge">
                            {{ homework.get_priority_display }}
                        </span>
                    </div>
                </div>
                <div class="homework-actions">
                    <button class="btn btn-primary" id="gradeBtn">
                        {% if homework.grade %}–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É{% else %}–í—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É{% endif %}
                    </button>
                    {% if homework.attachments.exists %}
                    <a href="{% url 'download_homework_zip' homework.id %}" class="btn btn-secondary" id="downloadBtn">
                        –°–∫–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É (ZIP)
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–¥–∞–Ω–∏–∏ -->
            <div class="homework-info-grid">
                <div class="info-card">
                    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—É–¥–µ–Ω—Ç–µ</h3>
                    <div class="info-content">
                        <div class="info-item">
                            <span class="info-label">–§–ò–û:</span>
                            <span class="info-value" id="studentName">{{ homework.student.full_name }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–ì—Ä—É–ø–ø–∞:</span>
                            <span class="info-value" id="studentGroup">
                                {% if homework.student.group %}
                                    {{ homework.student.group.name }}
                                {% else %}
                                    –ù–µ —É–∫–∞–∑–∞–Ω–∞
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email:</span>
                            <span class="info-value" id="studentEmail">{{ homework.student.user.email }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–¢–µ–ª–µ—Ñ–æ–Ω:</span>
                            <span class="info-value" id="studentPhone">
                                {% if homework.student.phone %}
                                    {{ homework.student.phone }}
                                {% else %}
                                    –ù–µ —É–∫–∞–∑–∞–Ω
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–¥–∞–Ω–∏—è</h3>
                    <div class="info-content">
                        <div class="info-item">
                            <span class="info-label">–ö—É—Ä—Å:</span>
                            <span class="info-value" id="courseName">{{ homework.assignment.course.title }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–¢–∏–ø —Ä–∞–±–æ—Ç—ã:</span>
                            <span class="info-value" id="workType">{{ homework.assignment.get_assignment_type_display }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–¢–µ–º–∞:</span>
                            <span class="info-value" id="workTopic">{{ homework.assignment.title }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–ë–∞–ª–ª—ã:</span>
                            <span class="info-value" id="maxPoints">{{ homework.assignment.max_points }} –º–∞–∫—Å.</span>
                        </div>
                    </div>
                </div>

                <div class="info-card">
                    <h3>–°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
                    <div class="info-content">
                        <div class="info-item">
                            <span class="info-label">–í—ã–¥–∞–Ω–æ:</span>
                            <span class="info-value" id="assignedDate">{{ homework.assignment.created_at|date:"d.m.Y" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–°—Ä–æ–∫ —Å–¥–∞—á–∏:</span>
                            <span class="info-value" id="dueDate">{{ homework.assignment.due_date|date:"d.m.Y H:i" }}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–°–¥–∞–Ω–æ:</span>
                            <span class="info-value" id="submittedDate">
                                {% if homework.submitted_at %}
                                    {{ homework.submitted_at|date:"d.m.Y H:i" }}
                                {% else %}
                                    –ù–µ —Å–¥–∞–Ω–æ
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">–°—Ç–∞—Ç—É—Å:</span>
                            <span class="info-value" id="submissionStatus">
                                {% if homework.submitted_at %}
                                    {% if homework.submitted_at <= homework.assignment.due_date %}
                                        –°–¥–∞–Ω–æ –≤–æ–≤—Ä–µ–º—è
                                    {% else %}
                                        –°–¥–∞–Ω–æ —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º
                                    {% endif %}
                                {% else %}
                                    –ù–µ —Å–¥–∞–Ω–æ
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –†–∞–±–æ—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ -->
            <div class="homework-content">
                <div class="content-section">
                    <h3>–†–∞–±–æ—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞</h3>
                    <div class="submission-content">
                        {% if homework.attachments.exists %}
                        <div class="file-attachments">
                            <h4>–ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                            <div class="file-list">
                                {% for attachment in homework.attachments.all %}
                                <div class="file-item">
                                    <span class="file-icon">
                                        {% if attachment.file_name|lower|slice:'-4:' == '.pdf' %}üìÑ
                                        {% elif attachment.file_name|lower|slice:'-5:' == '.docx' %}üìù
                                        {% elif attachment.file_name|lower|slice:'-4:' == '.zip' %}üì¶
                                        {% elif attachment.file_name|lower|slice:'-4:' == '.jpg' or attachment.file_name|lower|slice:'-5:' == '.jpeg' or attachment.file_name|lower|slice:'-4:' == '.png' %}üñºÔ∏è
                                        {% else %}üìé{% endif %}
                                    </span>
                                    <span class="file-name">{{ attachment.file_name }}</span>
                                    <span class="file-size">({{ attachment.get_file_size }})</span>
                                    <a href="{% url 'download_attachment' attachment.id %}" class="file-download">–°–∫–∞—á–∞—Ç—å</a>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if homework.text_content %}
                        <div class="text-submission">
                            <h4>–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç:</h4>
                            <div class="submission-text" id="submissionText">
                                {{ homework.text_content|linebreaks }}
                            </div>
                        </div>
                        {% else %}
                        <div class="text-submission">
                            <h4>–¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç:</h4>
                            <div class="submission-text empty">
                                –°—Ç—É–¥–µ–Ω—Ç –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- –û—Ü–µ–Ω–∫–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
                <div class="grading-section">
                    <h3>–û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç—ã</h3>
                    
                    <!-- –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ –µ—Å—Ç—å) -->
                    <div class="grade-display-mode {% if not homework.grade %}hidden{% endif %}" id="gradeDisplayMode">
                        {% if homework.grade %}
                        <div class="grade-display">
                            <div class="grade-info">
                                <div class="grade-value">
                                    <strong>–û—Ü–µ–Ω–∫–∞:</strong>
                                    {% if homework.grade.grade_value %}
                                        {{ homework.grade.grade_value }} ({{ homework.grade.grade_with_text }})
                                    {% else %}
                                        –ù–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞
                                    {% endif %}
                                </div>
                                <div class="points-value">
                                    <strong>–ë–∞–ª–ª—ã:</strong> 
                                    {% if homework.grade.points %}
                                        {{ homework.grade.points }}/{{ homework.assignment.max_points }}
                                    {% else %}
                                        –ù–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã
                                    {% endif %}
                                </div>
                                <div class="grade-teacher">
                                    <strong>–ü—Ä–æ–≤–µ—Ä–∏–ª:</strong> {{ homework.grade.teacher.get_full_name }}
                                </div>
                                <div class="grade-date">
                                    <strong>–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:</strong> {{ homework.grade.graded_at|date:"d.m.Y H:i" }}
                                </div>
                            </div>
                            
                            <!-- –ë–õ–û–ö –î–õ–Ø –ó–ê–ü–†–û–°–ê –î–û–†–ê–ë–û–¢–ö–ò -->
                            {% if homework.grade.is_revision_request %}
                            <div class="revision-request"
                                class="revision-request" style="
                                background-color: #fff3cd;
                                border: 1px solid #ffeaa7;
                                border-radius: 4px;
                                padding: 15px;
                                margin: 15px 0;
                            ">
                                <h4 style="
                                    color: #856404;
                                    margin-top: 0;
                                    display: flex;
                                    align-items: center;
                                    gap: 8px;
                                ">
                                    <span style="
                                        background: #856404;
                                        color: white;
                                        width: 24px;
                                        height: 24px;
                                        border-radius: 50%;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 14px;
                                    ">!</span>>
                                    –ó–∞–ø—Ä–æ—Å –¥–æ—Ä–∞–±–æ—Ç–∫–∏
                                </h4>
                                <div class="revision-comment">{{ homework.grade.comment|linebreaks }}</div>
                                <div class="revision-date">
                                    <small>–ó–∞–ø—Ä–æ—à–µ–Ω–æ: {{ homework.grade.graded_at|date:"d.m.Y H:i" }}</small>
                                </div>
                            </div>

                            {% elif homework.grade.comment %}
                            <div class="teacher-comment">
                                <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</h4>
                                <div class="comment-content">{{ homework.grade.comment|linebreaks }}</div>
                            </div>
                            {% endif %}
                            
                            <div class="grading-actions">
                                <button class="btn btn-secondary" id="editGradeBtn">–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
                            </div>
                        </div>
                        {% else %}
                        <div class="no-grade-message">
                            <p>–û—Ü–µ–Ω–∫–∞ –µ—â–µ –Ω–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞.</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è/—Å–æ–∑–¥–∞–Ω–∏—è –æ—Ü–µ–Ω–∫–∏ -->
                    <div class="edit-grade-mode {% if not homework.grade %}active{% endif %}" id="editGradeMode">
                        <form method="POST" action="{% url 'grade_homework' homework.id %}" id="gradingForm">
                            {% csrf_token %}
                            <input type="hidden" name="homework_id" value="{{ homework.id }}">
                            
                            <div class="grade-input">
                                <label for="grade_value">–û—Ü–µ–Ω–∫–∞:</label>
                                <div class="grade-selector">
                                    <select id="grade_value" name="grade_value" class="form-control" required>
                                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É</option>
                                        {% for value, label in grade_choices %}
                                        <option value="{{ value }}" 
                                            {% if homework.grade and homework.grade.grade_value == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                        {% endfor %}
                                    </select>
                                    <span class="max-grade">–∏–∑ 5</span>
                                </div>
                            </div>

                            <div class="points-input">
                                <label for="points">–ë–∞–ª–ª—ã:</label>
                                <div class="points-selector">
                                    <input type="number" id="points" name="points" class="form-control" 
                                           min="0" max="{{ homework.assignment.max_points }}" 
                                           value="{% if homework.grade %}{{ homework.grade.points }}{% else %}0{% endif %}" 
                                           placeholder="0" required>
                                    <span class="max-points">–∏–∑ {{ homework.assignment.max_points }}</span>
                                </div>
                            </div>

                            <div class="comments-input">
                                <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è:</label>
                                <textarea id="comment" name="comment" class="form-control" rows="6" 
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ä–∞–±–æ—Ç–µ...">{% if homework.grade %}{{ homework.grade.comment }}{% endif %}</textarea>
                            </div>

                            <div class="common-comments">
                                <label>–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</label>
                                <div class="quick-comments">
                                    <button type="button" class="quick-comment-btn" data-comment="–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!">–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!</button>
                                    <button type="button" class="quick-comment-btn" data-comment="–•–æ—Ä–æ—à–æ, –Ω–æ –µ—Å—Ç—å –Ω–µ–¥–æ—á–µ—Ç—ã">–•–æ—Ä–æ—à–æ, –Ω–æ –µ—Å—Ç—å –Ω–µ–¥–æ—á–µ—Ç—ã</button>
                                    <button type="button" class="quick-comment-btn" data-comment="–ù—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å">–ù—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å</button>
                                    <button type="button" class="quick-comment-btn" data-comment="–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ">–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</button>
                                </div>
                            </div>

                            <div class="grading-actions">
                                <button type="submit" class="btn btn-success" id="submitGrade">
                                    {% if homework.grade %}–û–±–Ω–æ–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É{% else %}–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É{% endif %}
                                </button>
                                
                                {% if homework.grade %}
                                <button type="button" class="btn cancel-edit-btn" id="cancelEditBtn">–û—Ç–º–µ–Ω–∞</button>
                                {% endif %}
                                
                                <button type="button" class="btn btn-outline" id="requestRevisionBtn">–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Ä–∞–±–æ—Ç–∫—É</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ -->
                <div class="history-section">
                    <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
                    <div class="history-timeline">
                        <div class="history-item">
                            <div class="history-date">{{ homework.created_at|date:"d.m.Y H:i" }}</div>
                            <div class="history-action">–ó–∞–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ</div>
                        </div>
                        
                        {% if homework.submitted_at %}
                        <div class="history-item">
                            <div class="history-date">{{ homework.submitted_at|date:"d.m.Y H:i" }}</div>
                            <div class="history-action">–°—Ç—É–¥–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª —Ä–∞–±–æ—Ç—É</div>
                        </div>
                        {% endif %}
                        
                        {% if homework.grade %}
                        <div class="history-item">
                            <div class="history-date">{{ homework.grade.graded_at|date:"d.m.Y H:i" }}</div>
                            <div class="history-action">
                                –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å {{ homework.grade.teacher.get_full_name }} –≤—ã—Å—Ç–∞–≤–∏–ª –æ—Ü–µ–Ω–∫—É
                                {% if homework.grade.comment %}
                                <br><small>{{ homework.grade.comment|truncatechars:100 }}</small>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ -->
    <div id="revisionModal" class="modal hidden">
        <div class="modal-content">
            <h3>–ó–∞–ø—Ä–æ—Å –¥–æ—Ä–∞–±–æ—Ç–∫–∏</h3>
            <p>–£–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ä–∞–±–æ—Ç–µ:</p>
            <textarea id="revisionComment" class="form-control" rows="6" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö, –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏, –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—ã–≤–æ–¥..."></textarea>
            <div class="modal-actions">
                <button id="submitRevision" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
                <button id="cancelRevision" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ/–æ—à–∏–±–∫–µ -->
    <div id="messageToast" class="toast hidden">
        <div class="toast-content" id="toastMessage"></div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript -->
    <script src="{% static 'js/homework-detail.js' %}"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ JS
        window.HOMEWORK_ID = {{ homework.id }};
        window.MAX_POINTS = {{ homework.assignment.max_points }};
        window.HAS_GRADE = {% if homework.grade %}true{% else %}false{% endif %};
        window.CSRF_TOKEN = "{{ csrf_token }}";
        
        // CSRF —Ç–æ–∫–µ–Ω –¥–ª—è AJAX –∑–∞–ø—Ä–æ—Å–æ–≤
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        window.csrftoken = getCookie('csrftoken');
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const gradeBtn = document.getElementById('gradeBtn');
            const editGradeBtn = document.getElementById('editGradeBtn');
            const cancelEditBtn = document.getElementById('cancelEditBtn');
            const gradeDisplayMode = document.getElementById('gradeDisplayMode');
            const editGradeMode = document.getElementById('editGradeMode');
            
            // –ö–Ω–æ–ø–∫–∞ "–í—ã—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É" –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
            if (gradeBtn) {
                gradeBtn.addEventListener('click', function() {
                    if (gradeDisplayMode) {
                        gradeDisplayMode.classList.add('hidden');
                    }
                    if (editGradeMode) {
                        editGradeMode.classList.add('active');
                    }
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
                    document.querySelector('.grading-section').scrollIntoView({ 
                        behavior: 'smooth' 
                    });
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫—É" –≤ –±–ª–æ–∫–µ —Å –æ—Ü–µ–Ω–∫–æ–π
            if (editGradeBtn) {
                editGradeBtn.addEventListener('click', function() {
                    if (gradeDisplayMode) {
                        gradeDisplayMode.classList.add('hidden');
                    }
                    if (editGradeMode) {
                        editGradeMode.classList.add('active');
                    }
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
                    editGradeMode.scrollIntoView({ 
                        behavior: 'smooth',
                        block: 'start'
                    });
                });
            }
            
            // –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" –≤ —Ñ–æ—Ä–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', function() {
                    if (gradeDisplayMode) {
                        gradeDisplayMode.classList.remove('hidden');
                    }
                    if (editGradeMode) {
                        editGradeMode.classList.remove('active');
                    }
                });
            }
        });
    </script>
</body>
</html>